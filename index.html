<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Rummy Game</title>
    <link rel="icon" type="image/png" href="icon-192x192.png">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#005000"/>    
</head>
<body>
    <h1 style="display: flex; align-items: center; justify-content: center;">
    <img src="icon-512x512.png" alt="Rummy Game Icon" style="width: 50px; margin-right: 15px;">
    Indian Rummy Game
</h1>
    

    <div id="settings-screen">
        <img src="icon-512x512.png" alt="Rummy Game Icon" style="width: 50%; max-width: 256px; margin-bottom: 20px;">
        <h2>Game Settings</h2>
        <div class="setting-item">
            <label for="num-players">Opponents:</label>
            <select id="num-players">
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>
        <div class="setting-item">
            <label for="num-rounds">Rounds:</label>
            <select id="num-rounds">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3" selected>3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
            </select>
        </div>
        <div class="setting-item">
            <label for="hidden-joker">Hidden Joker Rule:</label>
            <input type="checkbox" id="hidden-joker" checked>
        </div>
        <div class="setting-item">
            <label for="debug-mode">Learner Mode (Show AI Hands):</label>
            <input type="checkbox" id="debug-mode">
        </div>
        <div class="setting-item">
            <label for="fast-mode">Fast Mode (No Animations/Sound):</label>
            <input type="checkbox" id="fast-mode" checked>
        </div>
        <a href="how-to-play.html" style="color: #FFD700; margin-top: 15px; display: inline-block;">How to Play</a>
        <br>
        <button id="install-btn" style="display:none;">Install in Local Device</button>
        <br>
        <button id="show-stats-btn">Show Statistics</button>
        <br>
        <button id="start-game-btn">Start Game</button>
        <p style="margin-top: 20px; font-size: 14px;">Developed by S. Rathinagiri, in collaboration with Google Gemini</p>
    </div>


    <div id="scoreboard-screen" style="display: none;">
        <img src="icon-512x512.png" alt="Rummy Game Icon" style="width: 50%; max-width: 256px; margin-bottom: 20px;">
        <h2 id="round-winner-text"></h2>
        <h2 id="game-winner-text" style="margin-top:10px;"></h2>
        <h3>Scoreboard</h3>
        <table id="score-table"></table>
        <div class="scoreboard-actions">
            <button id="next-round-btn">Next Round</button>
            <button id="scoreboard-new-game-btn" style="display: none;">New Game</button>
            <button id="scoreboard-home-btn" style="display: none;">Back to Home</button>
            <button id="close-stats-btn" style="display: none;">Close</button>
        </div>
    </div>
    
    <div id="showdown-screen" style="display: none;">
        <img src="icon-512x512.png" alt="Rummy Game Icon" style="width: 50%; max-width: 256px; margin-bottom: 20px;">
        <h2 id="showdown-title"></h2>
        <div id="showdown-content"></div>
        <button id="continue-to-scoreboard-btn">Continue</button>
    </div>    

    <div id="game-container" style="display: none;">
        <canvas id="gameCanvas" width="1280" height="800"></canvas>
        <div class="controls">
            <button id="sortButton">Sort</button>
            <button id="meldButton">Group</button>
            <button id="revealJokerButton">Reveal Joker</button>
            <button id="discardButton">Discard</button>
            <button id="declareButton">Declare</button>
        </div>
    </div>
    <div id="debug-area" style="display: none;">
        <h3>AI Hand Debug</h3>
        <div id="debug-content"></div>
    </div>
    <audio id="audio-shuffle" src="shuffle.mp3" preload="auto"></audio>
    <audio id="audio-draw" src="draw.mp3" preload="auto"></audio>
    <audio id="audio-discard" src="discard.mp3" preload="auto"></audio>
    <audio id="audio-meld" src="meld.mp3" preload="auto"></audio>
    <audio id="audio-declare" src="declare.mp3" preload="auto"></audio>
    <audio id="audio-win" src="win.mp3" preload="auto"></audio>
    <audio id="audio-error" src="error.mp3" preload="auto"></audio>
    <audio id="audio-click" src="click.mp3" preload="auto"></audio>    
    
    <script type="module" src="main-v2.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            const swVersion = 'v1';
            const basePath = window.location.pathname.split('/').slice(0, -1).join('/') + '/';
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(`${basePath}sw.js?v=${swVersion}`);
            });
        }
    </script>
    <script>
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'inline-block';
        });

        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) {
                return;
            }
            deferredPrompt.prompt();
            await deferredPrompt.userChoice;
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });

        window.addEventListener('appinstalled', () => {
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });
    </script>
  </body>
  </html>
